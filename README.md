# MUZZ Application

![logo](resources/muzz.png)

Implementation of a simple application that fulfils the requirements of the MUZZ backend exercise.
Discussion of **architectural and design choices** were left to the end of the document.

- [Introduction](#introduction)
- [How To Run](#how-to-run)
- [API](#api)
- [Code Structure](#code-structure)
- [Data Model](#data-model)
- [Architecture and Design Choices](#architecture-and-design-choices)

## Introduction

This is a very simple Go app, made using Go 1.22.4
Main libs used:

- [Gin](https://github.com/gin-gonic/gin) for routing, request context and middleware.
- [pgx](https://github.com/jackc/pgx) for PostgreSQL connection and driver.

App was developed on a Linux environment, with Docker version **24.0.5** and Docker Compose version **2.20.3**.

## How To Run

The application is fully containerized, so assuming Docker and Docker Compose are installed, you can run the app with
the following command:

```bash
# start the app in detached mode
docker-compose up -d app

# tail logs with
docker-compose logs -f app

# stop the app with
docker-compose down
```

Alternatively, you can run the app locally, as long a the instance of PostgresSQL is running:

```bash
# boot up db
docker-compose up -d postgres

# run the app
make run
```

The provided make file can start the app, removing any other apps running on the same port.

**Note:** The Postgres data base must be PostGIS ready with the extension installed. The provided docker-compose file
will take care of that.

## API

- **Health Check**
    - **Method:** GET
    - **Endpoint:** `/health`
    - **Handler:** `handler.Health`
    - **Description:** Endpoint for health status monitoring.

---

- **Create User**
    - **Method:** POST
    - **Endpoint:** `/user/create`
    - **Handler:** `handler.CreateUser`
    - **Description:** Endpoint for creating a new user.
    - **Response:** `201 Created`
    - **Request Body:** None
    - **Response Body:**
    ```json
    {
        "id": 7,
        "email": "james@gmail.com",
        "password": "7q5Cs^1RF3#U",
        "name": "Elizabeth Davis",
        "gender": "F",
        "age": 58
    }
    ```

---

- **Login**
    - **Method:** POST
    - **Endpoint:** `/login`
    - **Handler:** `handler.Login`
    - **Description:** Endpoint for user authentication and login.
    - **Response:** `201 Created`
    - **Request Body:** 
    ```json
    {
        "email": "email@gmail.com",
        "password": "7q5Cs^1RF3#U"
    }
    ```
    - **Response Body:**
    ```json
    {
       "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTk3ODM4MzgsImlhdCI6MTcxOTY5NzQzOCwic3ViIjoiMSJ9.5l9piRKs_brYRYgxbADRFu4HrZmUU0gP2_Y08vG67Sc"
    }
    ```

---

- **Discover**
    - **Method:** GET
    - **Endpoint:** `/discover`
    - **Authenticated:** Yes
    - **Handler:** `handler.Discover`
    - **Description:** Endpoint to discover potential matches. Query params are all optional.
    - **Response:** `200 OK`
    - **Response Body:**
    ```json
  [
    {
      "id": 3,
      "name": "Jessica Williams",
      "gender": "F",
      "age": 44,
      "distance_from_me": 10525.32
    },
    {
      "id": 4,
      "name": "Lauren Jones",
      "gender": "F",
      "age": 22,
      "distance_from_me": 11815.06
    }
  ]
    
    ```

- **Swipe**
    - **Method:** POST
    - **Endpoint:** `/swipe`
    - **Authenticated:** Yes
    - **Handler:** `handler.Swipe`
    - **Description:** Endpoint for swiping left or right on matches.
    - **Response:** `201 Created`
    - **Error Response:** `400 Bad Request` | `409 Conflict`
    - **Response:** `201 Created`
    - **Request Body:**
      ```json
      {
      "user_id": 2,
      "preference": "YES"
      }
      ```
    - **Response Body:**
      ```json
      {
        "matched": false
      }
      ```
---
<br/>

**Authentication**

Authenticated endpoints require a valid JWT token in the `Authorization` header. 
The token is generated by the `/login`.
Token must be a **Bearer** token.  
e.g.

![auth](resources/token.png)

## Code Structure

```plaintext
.
├── api
│   └── router.go
├── config
│   └── config.go
├── db
│   └── db.go
└── pkg
    ├── cryptography
    ├── dao
    ├── handler
    ├── middleware
    ├── types
    └── workers
main.go
```

The best **entry point** would the the `router.go` file, which is responsible for setting up the mapping
of the routes and the handlers.

The `config.go` file is responsible for setting up the configuration of the app, 
while the `db.go` set up the connection pool to the database.

## Data Model

![tables](resources/tables.png)

Foreign keys were not used due to increase overhead and complexity. Also, app is simple enough to not require the 
extra check in terms of data consistency.

## Architecture and Design Choices


